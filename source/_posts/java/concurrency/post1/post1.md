---
title: 01java并发知识入门
date: 2020-05-17 13:28:13
categories:
    - java并发
    - java并发原理及实践
tags:
---


# 1 并发简史

在计算机发明早期，一台计算机在同一时间只能运行一个程序。如果将人比作一台计算机的话，就是一个人在同一时间内只能做一件事情不能三心二意。就拿博主我做自己最擅长的皮蛋瘦肉粥这件事来说，我们要经历洗米、把米放锅中煮、切肉和皮蛋、找准火候放入肉和皮蛋、关电饭煲闷煮、电饭煲提示灯亮后吃饭，我们要按照顺序执行每一步，在得到结果后再执行下一步，最后得到最终的结果。同样对于早期的计算机来说，交给它一个任务如计算1+2的结果并打印，其要先分别拿到1和2放到寄存器中、然后执行加法运算得出结果3、然后把3回写到内存中、最后把结果通过打印机输出到纸上。大略一看，这个观点似乎没什么问题，但是效率上其实还可以提升下，不管是人做饭还是计算机执行算数任务这件事上。

不管是人还是机器，都需要提高自身资源的使用效率。人在做饭时最主要使用的是眼睛、双手、和大脑，我们另外一个主要器官耳朵在做饭过程中的使用率并不是太高，这样我们就可以变做饭边听早间新闻提高我们自身器官的使用率，那么效率自然也就提升了。对于计算机来说道理也是相同，在计算机执行计算任务时主要使用的是CPU，在计算机回写计算结果时使用的主要是I/O设备，如果我们能让计算机在执行1+2任务的计算部分时，能让闲置的I/O设备忙起来搞其它任务的输入或者输出部分的工作；亦或在计算机通过I/O设备将1+2的计算结果打印到纸上时，让闲置的CPU来执行其它任务的计算部分。那么假设本来需要两个小时完成的类似1+2这种计算结果并打印的大量任务，现在提升效率后大体只需要一个小时就能完成了。

人们为了提升计算机各种设备的使用效率，引入了操作系统来统一管理计算机中的各种设备。所有的任务只需要和操作系统打交道，由操作系统统一调度计算机中的各种设备，尽最大可能保证各种设备在同一时间没有被闲置。操作系统除了保证各种设备没有被闲置外，还要保证各种任务在使用计算机设备时尽可能的公平，当我们用计算机的CPU解码mp3文件听歌时，不能因要执行1+2的计算任务把CPU抢占过去后不能听歌曲了，操作系统会把任务对CPU的使用时间切成无数小的几毫秒的时间片段，每个任务交替的获取使用CPU的时间片段来保证各个任务在执行顺序上的公平。不同任务对CPU按照时间片来交替使用，这个叫做并发。

# 2 java中的并发编程

上节我们知道计算系统分配CPU时间片的最小单位是一个个具体的任务，操作系统提供线程的概念给各种各样的程序，程序把一个大任务按照不同的性质分隔成小任务，每个小任务被封装在一个线程中交给操作系统来调度执行。同一个程序中的线程由如下特点：

+ 资源共享，操作系统分配给程序的各种资源对于线程来说都是共享的，如内存，CPU等。

+ 

java中的并发编程问题也就是对线程管理问题，即怎样管理才能让线程的程序的执行效率更高同时不出差错。具体来说就是以下三大问题：

1. 正确性问题。由于线程可以共享程序中的各种资源，这有可能导致多个线程对同一个资源的竞争使用，如果把行驶的汽车比作一个个线程，把道路比作程序中的共享资源，在没有合理的管控下汽车对道路的竞争势必会导致严重的交通事故。线程之间对资源的竞争如果不加管控则可导致程序执行出错。

2. 可行性问题。继续拿交通系统来举例，如果出现交通事故那么就是没能保证程序的正确性；如果所有车辆因为调度不合理而都堵死在公路上就是可行性问题。在java并发编程中死锁就是典型的可能性问题，两个线程分别拿着对方想要的资源不放，就像在公路上不肯给对方让路的相向而行的汽车一样，太多的“顶牛”会导致交通瘫痪，太多的死锁可能导致程序崩溃。

3. 高效性问题。一个交通系统中的所有车辆如果被合理调度，那么交通系统的吞吐量会显著提高。同样的在一个设计合理的java程序中，多线程的使用能显著提高程序的执行效率。

这三大问题正确性是基本，不管是不是并发编程，首先你要保证执行的结果是正确的；其次是可行性，程序如果引入了java并发编程先不说效率能提升多少，最起码程序能够顺利执行完成；最后是高效性问题，在满足正确性和可行性时，我们希望我们的程序能在java并发的加持下，相较于顺序执行的程序更快的完成任务。本系列文章会围绕这三大问题进行展开！







