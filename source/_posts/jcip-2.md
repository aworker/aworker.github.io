---
title: 《java并发编程实战》第二章：线程安全
date: 2017-10-10 11:29:50
tags: java并发
---

第一章主要通过多线程如何重要，多线程将来要应用的越来越多，像是全书的一个引子，就是告诉读者，你选择本书没有错，这本书讲述的就是java中最重要的多线程部分，是程序开发技术中的屠龙刀。诚然本书（英文版本）是在2006年既java诞生10周年时候出版的。距离我2017年看本书已经过十年多的时间，虽然此书仍然是java并发界，乃至程序并发界一本经典书籍，此书中的绝大多数观点依然没有过时，但是计算机技术日新月异，十年前的很多观点到现在可能已经不在适用了，这需要在阅读过程中多加辨析。
第二章在第一章的基础上告诉读者在重要的多线程开发中线程安全的重要性，随着计算机硬件的发展，我们可以利用多核心cpu并发能力来让多个程序同时运行，这是这样计算机的效率就非常高，这是多线程开发的优点。但是要想享受这个优点，就要遵守多线程开发的“规则”。这个规则就是第二章介绍的-线程安全。作者在章首表达了两个观点：
>A program that omits needed synchronization might appear to work, passing its tests and performing well for years, but it is still broken and may fail at any moment.
>It is far easier to design a class to be thread-safe than to retrofit it for thread safety later.
<div align=right><b> Java Concurrency in Practice</b><div>

两个观点分别强调线程安全在多线程环境的必要性：
1. 你本应该应用并发的代码即使已经在生产环境中运行了很久，并且表现良好，但是它们也随时有可能崩溃。
2. 去修复一个类或者一段代码来保证它们是线程安全的远比当初就把它们设计成线程安全的要复杂的多。

对于第一点，我是感触颇深的，在刚工作不久有个同事开发一个功能，需要用到多线程技术，同事也非常注意多线程开发过程中的线程安全问题，没日没夜的忙了快两个月，后来又联合程序，测试，产品等测试将近一个月。可是到了功能上线的时候还是出现了死锁等线程安全问题。此后每周改功能上线的时候都会或多或少的爆出线程安全问题，直到功能正式上线1个月后才算稳定。在严密的测试也不能排查所有线上可能发生的多线程问题。
第二点，可以参考修改老代码...改过别人代码的小伙伴们都懂。修复非线程安全类为线程安全的类和完善别人的代码本质上没有区别。都是抄剩饭。
说了半天线程安全，那么什么是线程安全呢？
{% img ./jcip_2/question.jpg %}



















